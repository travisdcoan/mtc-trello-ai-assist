<script src="https://p.trellocdn.com/power-up.min.js"></script>
<script>
  const APP_KEY = "2d28f67731b868888a2fc22bdd3295af";
  const t = window.TrelloPowerUp.iframe();
  
  t.render(async () => {
    try {
      // 1) Debug args
      const cardId   = t.arg('id');
      const cardName = t.arg('name');
      console.log("[Popup] args:", { cardId, cardName });
      
      if (!cardId || !cardName) {
        throw new Error("Missing card id or name");
      }

      // 2) Update the message
      document.getElementById('message').textContent =
        `Would you like to title it “Fix ${cardName}”?`;

      // 3) Render buttons
      const verbs = ["Add","Assign","Close","Create","Fix","Review","Update","Write"];
      const container = document.getElementById('suggestions');
      container.innerHTML = ""; // clear any old
      
      verbs.forEach(verb => {
        const newName = `${verb} ${cardName}`;
        const btn = document.createElement('button');
        btn.textContent = newName;
        btn.addEventListener('click', () => {
          console.log(`[Popup] clicked suggestion: ${newName}`);
          // for now just close; we’ll re-add the rename fetch later
          t.closePopup();
        });
        container.appendChild(btn);
      });

      // 4) Cancel
      document.getElementById('cancel-btn')
        .addEventListener('click', () => {
          console.log("[Popup] cancel");
          t.closePopup();
        });

    } catch (err) {
      console.error("[Popup] error in render:", err);
      document.body.innerHTML = "<p style='color:red'>Error loading suggestions. Check console.</p>";
    }
  });
</script>
